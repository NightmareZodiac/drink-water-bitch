<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kawaii Water Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --lavender-main: #d7c8ff;
      --lavender-dark: #a995e5;
      --text-main: #2a223c;
      --text-soft: #7b6d9b;
      --water: #b3ecff;
      --water-dark: #87d4f4;
      --button-border: rgba(183,163,255,0.7);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: transparent;      /* nice in Notion embed */
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .widget {
      width: 360px;
      max-width: 100%;
      background: #ffffff;
      border-radius: 22px;
      padding: 18px 18px 14px;
      box-shadow: 0 18px 30px rgba(155, 132, 230, 0.25);
      border: 1px solid rgba(180, 160, 255, 0.6);
    }

    /* HEADER (DATE ONLY) */
    .header {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    /* MAIN LAYOUT */

    .main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items: center;
    }

    .cup-wrap {
      display: flex;
      justify-content: center;
    }

    .cup {
      position: relative;
      width: 150px;
    }

    .cup img {
      width: 100%;
      display: block;
      position: relative;
      z-index: 3; /* art above water */
    }

    /* WATER AREA INSIDE HEART (BEHIND CUP) */
    #water {
      position: absolute;
      z-index: 1;          /* stays behind img */
      left: 26%;           /* tuned for your new heart */
      width: 48%;
      bottom: 21%;         /* aligns with bottom point of heart */
      height: 0%;          /* JS controls this 0–65% */
      background: linear-gradient(180deg, var(--water), var(--water-dark));
      border-radius: 0 0 32px 32px;
      transition: height 0.4s ease-out;
      opacity: 0.96;
      overflow: hidden;
      pointer-events: none;
    }

    /* SPARKLES */

    .sparkle {
      position: absolute;
      width: 12px;
      height: 12px;
      pointer-events: none;
      animation: sparkleFloat 900ms ease-out forwards;
      opacity: 0;
      z-index: 10;
    }

    .sparkle::before {
      content: "✧";
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #ffffff;
      text-shadow:
        0 0 4px rgba(255,255,255,0.9),
        0 0 10px rgba(186,248,240,0.9);
    }

    @keyframes sparkleFloat {
      0%   { transform: translateY(8px) scale(0.7); opacity: 0; }
      20%  { opacity: 1; }
      100% { transform: translateY(-24px) scale(1.1); opacity: 0; }
    }

    /* STATS */

    .stats {
      font-size: 13px;
      line-height: 1.4;
    }

    .amount {
      font-size: 15px;
      font-weight: 600;
    }

    .percent {
      font-size: 24px;
      font-weight: 800;
      margin: 4px 0 2px;
    }

    .percent span {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-soft);
    }

    .bar {
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: #efe6ff;
      overflow: hidden;
      margin: 4px 0;
    }

    .bar-fill {
      height: 100%;
      width: 0%;
      background: var(--lavender-main);
      transition: width 0.4s ease-out;
      border-radius: 999px;
    }

    .surplus {
      font-size: 11px;
      margin-top: 4px;
      color: #b4345a;
      font-weight: 600;
      min-height: 14px;
    }

    .streak {
      margin-top: 8px;
      font-size: 11px;
      text-align: center;
      color: var(--text-soft);
    }

    /* GOAL INPUT */

    .goal-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .goal-row input {
      width: 80px;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(183,163,255,0.8);
      font-size: 11px;
      text-align: right;
      outline: none;
    }

    .goal-row input:focus {
      box-shadow: 0 0 0 2px rgba(183,163,255,0.5);
      border-color: var(--lavender-dark);
    }

    /* BUTTONS */

    .controls {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .row {
      display: flex;
      gap: 8px;
    }

    button {
      flex: 1;
      padding: 10px 0;
      border: none;
      border-radius: 12px;
      text-transform: uppercase;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.03em;
      cursor: pointer;
      box-shadow:
        0 0 0 1px var(--button-border),
        0 4px 10px rgba(164,132,222,0.3);
      transition: 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

.add-btn,
.minus-btn {
  background: var(--lavender-main); /* both solid lavender */
  color: var(--text-main);
}

    button:hover {
      transform: translateY(-2px);
      box-shadow:
        0 0 0 1px rgba(150,125,230,0.9),
        0 6px 16px rgba(150,120,230,0.6);
    }

    button:active {
      transform: translateY(1px) scale(0.97);
    }

    @media (max-width: 420px) {
      .main { grid-template-columns: 1fr; }
      .widget { border-radius: 16px; }
    }
  </style>
</head>

<body>
<div class="widget">

  <!-- HEADER (DATE ONLY) -->
  <div class="header">
    <div class="subtitle" id="dateLabel"></div>
  </div>

  <!-- MAIN AREA -->
  <div class="main">

    <!-- CUP -->
    <div class="cup-wrap">
      <div class="cup" id="cup">
        <!-- water behind the art -->
        <div id="water"></div>
        <img src="cup.png" alt="Cup" />
      </div>
    </div>

    <!-- STATS -->
    <div class="stats">
      <div class="amount" id="amountText">0 / 2000 ml</div>
      <div class="percent" id="percentText">0% <span>of today’s goal</span></div>
      <div class="bar"><div class="bar-fill" id="barFill"></div></div>

      <div class="goal-row">
        <span>Goal:</span>
        <input type="number" id="goalInput" min="100" step="50" />
        <span>ml / day</span>
      </div>

      <div class="surplus" id="surplusText"></div>
    </div>

  </div>

  <!-- BUTTONS: +50 / -50 -->
  <div class="controls">
    <div class="row">
      <button class="add-btn"   id="plusBtn">+50 ml</button>
      <button class="minus-btn" id="minusBtn">−50 ml</button>
    </div>
  </div>

  <!-- STREAK -->
  <div class="streak" id="streakText">Streak: 0 days</div>
</div>

<!-- plip sound (optional) -->
<audio id="plipSound" src="plip.mp3" preload="auto"></audio>

<script>
  const WATER_MAX_HEIGHT = 52;  // max % of water box height

  const TOTAL_KEY  = "kawaii_water_total";
  const DATE_KEY   = "kawaii_water_date";
  const STREAK_KEY = "kawaii_water_streak";
  const GOAL_KEY   = "kawaii_water_goal";

  let goalMl     = 2000;
  let totalToday = 0;
  let streak     = 0;

  const waterEl       = document.getElementById("water");
  const amountTextEl  = document.getElementById("amountText");
  const percentTextEl = document.getElementById("percentText");
  const barFillEl     = document.getElementById("barFill");
  const dateLabelEl   = document.getElementById("dateLabel");
  const streakTextEl  = document.getElementById("streakText");
  const surplusTextEl = document.getElementById("surplusText");
  const goalInputEl   = document.getElementById("goalInput");
  const cupEl         = document.getElementById("cup");
  const plusBtn       = document.getElementById("plusBtn");
  const minusBtn      = document.getElementById("minusBtn");
  const plipSound     = document.getElementById("plipSound");

  /* DATE HELPERS (ISO to avoid timezone weirdness) */

  function todayISO() {
    const d = new Date();
    const local = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    return local.toISOString().slice(0, 10); // YYYY-MM-DD
  }

  function isoToDate(iso) {
    const parts = iso.split("-");
    if (parts.length !== 3) return new Date();
    const y = parseInt(parts[0], 10);
    const m = parseInt(parts[1], 10);
    const day = parseInt(parts[2], 10);
    return new Date(y, m - 1, day);
  }

  /* LOAD / SAVE STATE */

  function loadState() {
    const savedGoal   = parseInt(localStorage.getItem(GOAL_KEY)   || "2000", 10);
    const savedTotal  = parseInt(localStorage.getItem(TOTAL_KEY)  || "0", 10);
    const savedDate   = localStorage.getItem(DATE_KEY);
    const savedStreak = parseInt(localStorage.getItem(STREAK_KEY) || "0", 10);
    const today       = todayISO();

    goalMl     = (!isNaN(savedGoal) && savedGoal > 0) ? savedGoal : 2000;
    totalToday = (!isNaN(savedTotal) && savedTotal > 0) ? savedTotal : 0;

    if (!savedDate) {
      streak = 0;
      localStorage.setItem(DATE_KEY, today);
      localStorage.setItem(STREAK_KEY, "0");
      localStorage.setItem(TOTAL_KEY, String(totalToday));
      localStorage.setItem(GOAL_KEY, String(goalMl));
      return;
    }

    if (savedDate === today) {
      streak = isNaN(savedStreak) ? 0 : savedStreak;
      return;
    }

    // new day
    const prevDate = isoToDate(savedDate);
    const currDate = isoToDate(today);
    const diffDays = Math.round(
      (currDate - prevDate) / (1000 * 60 * 60 * 24)
    );

    if (diffDays === 1 && totalToday >= goalMl) {
      streak = (isNaN(savedStreak) ? 0 : savedStreak) + 1;
    } else {
      streak = 0;
    }

    totalToday = 0;
    localStorage.setItem(DATE_KEY, today);
    localStorage.setItem(STREAK_KEY, String(streak));
    localStorage.setItem(TOTAL_KEY, "0");
    localStorage.setItem(GOAL_KEY, String(goalMl));
  }

  function saveState() {
    localStorage.setItem(DATE_KEY, todayISO());
    localStorage.setItem(TOTAL_KEY, String(totalToday));
    localStorage.setItem(STREAK_KEY, String(streak));
    localStorage.setItem(GOAL_KEY, String(goalMl));
  }

  /* UI UPDATE */

  function updateUI() {
    const rawPct     = (totalToday / goalMl) * 100;
    const displayPct = Math.round(rawPct);

    const fillRatio    = totalToday / goalMl;                     // can be >1
    const clampedFill  = Math.max(0, Math.min(fillRatio, 1));     // 0–1
    const visualPct    = clampedFill * WATER_MAX_HEIGHT;          // 0–65%
    const barVisualPct = Math.max(0, Math.min(rawPct, 100));      // 0–100%

    waterEl.style.height     = visualPct + "%";
    amountTextEl.textContent = `${totalToday} / ${goalMl} ml`;
    percentTextEl.innerHTML  = `${isFinite(displayPct) ? displayPct : 0}% <span>of today’s goal</span>`;
    barFillEl.style.width    = barVisualPct + "%";

    const surplus = Math.max(0, totalToday - goalMl);
    surplusTextEl.textContent = surplus > 0 ? `Surplus: +${surplus} ml` : "";

    const d = new Date();
    dateLabelEl.textContent = d.toLocaleDateString(undefined, {
      weekday: "short",
      month: "short",
      day: "numeric"
    });

    streakTextEl.textContent = `Streak: ${streak} day${streak === 1 ? "" : "s"}`;
    goalInputEl.value = goalMl;
  }

  /* FUN STUFF */

  function spawnSparkles() {
    const rect = cupEl.getBoundingClientRect();
    for (let i = 0; i < 3; i++) {
      const s = document.createElement("div");
      s.className = "sparkle";
      const offsetX = rect.left + rect.width * (0.3 + Math.random() * 0.4);
      const offsetY = rect.top  + rect.height * (0.35 + Math.random() * 0.15);
      s.style.left = offsetX + "px";
      s.style.top  = offsetY + "px";
      document.body.appendChild(s);
      setTimeout(() => s.remove(), 900);
    }
  }

  function playPlip() {
    if (!plipSound) return;
    try {
      plipSound.currentTime = 0;
      plipSound.play().catch(() => {});
    } catch (_) {}
  }

  function addWater(amount) {
    totalToday = Math.max(0, totalToday + amount); // don’t go below 0
    saveState();
    updateUI();
    if (amount > 0) {
      spawnSparkles();
      playPlip();
    }
  }

  function changeGoal() {
    const val = parseInt(goalInputEl.value, 10);
    if (!isNaN(val) && val > 0) {
      goalMl = val;
      saveState();
      updateUI();
    } else {
      goalInputEl.value = goalMl; // revert invalid input
    }
  }

  /* INIT */

  loadState();
  updateUI();

  plusBtn.addEventListener("click", () => addWater(50));
  minusBtn.addEventListener("click", () => addWater(-50));
  goalInputEl.addEventListener("change", changeGoal);
</script>
</body>
</html>
